import{u as O,r as u,j as n,F as q,a as J,b as Y}from"./index-pePUiUqb.js";const G=[{title:"WebRTC leak",description:"Checks whether WebRTC exposes your real IP address."},{title:"IP consistency",description:"Compares IP addresses returned by multiple services to detect mismatches."},{title:"Timezone & language",description:"Highlights potential mismatches between browser language preferences and timezone."},{title:"Canvas fingerprint",description:"Evaluates how unique your Canvas rendering fingerprint is."},{title:"Font fingerprint",description:"Lists fonts exposed to the browser that may aid fingerprinting."},{title:"Hardware attributes",description:"Summarises visible information about your device screen and platform."}],V={screenResolution:"Screen resolution",availableScreen:"Available screen",colorDepth:"Color depth",cpuCores:"CPU cores",memory:"Memory",platform:"Platform",userAgent:"User agent"},Z=()=>{const{t:a,getSection:p}=O(),h=p("pages.browserTest.instructions"),v=Array.isArray(h)&&h.length>0?h:G,S=p("pages.browserTest.hardware.labels"),l={...V,...S||{}},b=a("common.notAvailable"),[w,C]=u.useState([]),[g,f]=u.useState(!1),[x,y]=u.useState(0);u.useEffect(()=>{T()},[]);const T=async()=>{f(!0),y(0);const e=[],t=6;let r=0;const s=W=>{e.push(W),r+=1,y(r/t*100),C([...e])},i=await j();s(i);const o=await N();s(o);const c=A();s(c);const d=await R();s(d);const m=await P();s(m);const B=L();s(B),f(!1)},j=()=>new Promise(e=>{const t=new Set,r=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});r.createDataChannel(""),r.createOffer().then(s=>r.setLocalDescription(s)),r.onicecandidate=s=>{if(!s||!s.candidate){r.close();const o=Array.from(t),c=o.some(d=>!z(d));e({name:a("pages.browserTest.tests.webrtc.name"),status:c?"danger":"safe",details:c?a("pages.browserTest.tests.webrtc.details.public",{count:o.length}):a("pages.browserTest.tests.webrtc.details.private",{count:o.length}),data:o});return}const i=s.candidate.candidate.match(/([0-9]{1,3}(\.[0-9]{1,3}){3})/);i&&t.add(i[1])},setTimeout(()=>{r.close();const s=Array.from(t);e({name:a("pages.browserTest.tests.webrtc.name"),status:s.length>0?"warning":"safe",details:a("pages.browserTest.tests.webrtc.details.countOnly",{count:s.length}),data:s})},2e3)}),N=async()=>{try{const[e,t]=await Promise.all([fetch("https://api.ipify.org?format=json"),fetch("https://api.ip.sb/ip")]),r=(await e.json()).ip,s=(await t.text()).trim(),i=r===s;return{name:a("pages.browserTest.tests.ipConsistency.name"),status:i?"safe":"warning",details:i?a("pages.browserTest.tests.ipConsistency.details.consistent"):a("pages.browserTest.tests.ipConsistency.details.inconsistent",{ip1:r,ip2:s}),data:{ip1:r,ip2:s}}}catch{return{name:a("pages.browserTest.tests.ipConsistency.name"),status:"warning",details:a("pages.browserTest.tests.ipConsistency.details.failed"),data:null}}},A=()=>{const e=Intl.DateTimeFormat().resolvedOptions().timeZone,t=navigator.language,r=navigator.languages,i=[{tz:"Asia/Shanghai",lang:"en-US"},{tz:"America/New_York",lang:"zh-CN"}].some(o=>e.includes(o.tz)&&t.includes(o.lang));return{name:a("pages.browserTest.tests.timezone.name"),status:i?"warning":"safe",details:a(i?"pages.browserTest.tests.timezone.details.mismatch":"pages.browserTest.tests.timezone.details.normal"),data:{timezone:e,language:t,languages:r}}},R=async()=>{const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)return{name:a("pages.browserTest.tests.canvas.name"),status:"warning",details:a("pages.browserTest.tests.canvas.details.noContext"),data:null};t.textBaseline="top",t.font="14px Arial",t.fillStyle="#f60",t.fillRect(125,1,62,20),t.fillStyle="#069",t.fillText("StarIPToolbox",2,15),t.fillStyle="rgba(102, 204, 0, 0.7)",t.fillText("StarIPToolbox",4,17);const r=e.toDataURL();await new Promise(c=>setTimeout(c,100));const s=e.toDataURL(),i=r===s,o=await $(r);return{name:a("pages.browserTest.tests.canvas.name"),status:i?"safe":"warning",details:a(i?"pages.browserTest.tests.canvas.details.stable":"pages.browserTest.tests.canvas.details.unstable"),data:{hash:`${o.substring(0,16)}...`}}},P=async()=>{const e=["monospace","sans-serif","serif"],t=["Arial","Verdana","Times New Roman","Courier New","SimSun","Microsoft YaHei","PingFang SC","Helvetica","Comic Sans MS","Impact","Tahoma","Trebuchet MS"],r=[],s=document.createElement("span");s.style.position="absolute",s.style.left="-9999px",s.style.fontSize="72px",s.innerHTML="mmmmmmmmmmlli",document.body.appendChild(s);const i={};return e.forEach(o=>{s.style.fontFamily=o,i[o]={width:s.offsetWidth,height:s.offsetHeight}}),t.forEach(o=>{let c=!1;e.forEach(d=>{s.style.fontFamily=`"${o}", ${d}`;const m={width:s.offsetWidth,height:s.offsetHeight};(m.width!==i[d].width||m.height!==i[d].height)&&(c=!0)}),c&&r.push(o)}),document.body.removeChild(s),{name:a("pages.browserTest.tests.font.name"),status:r.length>8?"warning":"safe",details:a("pages.browserTest.tests.font.details.detected",{count:r.length}),data:r}},L=()=>{const e={[l.screenResolution]:`${screen.width}x${screen.height}`,[l.availableScreen]:`${screen.availWidth}x${screen.availHeight}`,[l.colorDepth]:`${screen.colorDepth}bit`,[l.cpuCores]:navigator.hardwareConcurrency||b,[l.memory]:navigator.deviceMemory?`${navigator.deviceMemory}GB`:b,[l.platform]:navigator.platform,[l.userAgent]:`${navigator.userAgent.substring(0,50)}...`},t=k(e);return{name:a("pages.browserTest.tests.hardware.name"),status:t>70?"warning":"safe",details:a("pages.browserTest.tests.hardware.details.score",{value:t}),data:e}},z=e=>{const t=e.split(".").map(Number);return t[0]===10||t[0]===127||t[0]===172&&t[1]>=16&&t[1]<=31||t[0]===192&&t[1]===168},$=async e=>{const r=new TextEncoder().encode(e),s=await crypto.subtle.digest("SHA-256",r);return Array.from(new Uint8Array(s)).map(o=>o.toString(16).padStart(2,"0")).join("")},k=e=>{const t=JSON.stringify(e);return Math.min(95,50+t.length/20)},F=e=>{switch(e){case"safe":return n.jsx(Y,{className:"text-green-400",size:24});case"warning":return n.jsx(J,{className:"text-yellow-400",size:24});case"danger":return n.jsx(q,{className:"text-red-400",size:24});default:return null}},I=e=>{switch(e){case"safe":return"bg-green-500/20 border-green-500/50";case"warning":return"bg-yellow-500/20 border-yellow-500/50";case"danger":return"bg-red-500/20 border-red-500/50";default:return"bg-white/5 border-white/20"}},M=a("pages.browserTest.title"),H=a("pages.browserTest.subtitle"),E=a("pages.browserTest.progressLabel",{value:Math.round(x)}),D=a(g?"pages.browserTest.buttons.loading":"pages.browserTest.buttons.retry"),U=a("pages.browserTest.instructionsTitle");return n.jsxs("div",{className:"space-y-6 animate-fade-in",children:[n.jsxs("div",{className:"bg-white/10 backdrop-blur-md rounded-2xl shadow-2xl border border-white/20 p-6 sm:p-8",children:[n.jsx("h2",{className:"text-2xl sm:text-3xl font-bold text-white mb-4",children:M}),n.jsx("p",{className:"text-white/80 text-sm mb-6",children:H}),g&&n.jsxs("div",{className:"mb-6",children:[n.jsx("p",{className:"text-center text-white/80 mb-2",children:E}),n.jsx("div",{className:"w-full bg-white/20 rounded-full h-2.5",children:n.jsx("div",{className:"bg-gradient-to-r from-sky-400 to-white h-2.5 rounded-full transition-all duration-300",style:{width:`${x}%`}})})]}),n.jsx("button",{onClick:T,disabled:g,className:"w-full bg-gradient-to-r from-sky-400 to-white text-slate-800 font-bold py-3 px-4 rounded-lg hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 transform hover:scale-105",children:D})]}),w.length>0&&n.jsx("div",{className:"space-y-4",children:w.map((e,t)=>n.jsx("div",{className:`bg-white/10 backdrop-blur-md rounded-2xl shadow-2xl border p-6 animate-slide-in-up ${I(e.status)}`,children:n.jsxs("div",{className:"flex items-start gap-4",children:[n.jsx("div",{className:"flex-shrink-0 mt-1",children:F(e.status)}),n.jsxs("div",{className:"flex-1",children:[n.jsx("h3",{className:"text-lg font-bold text-white mb-2",children:e.name}),n.jsx("p",{className:"text-white/80 text-sm mb-3",children:e.details}),e.data&&n.jsx("div",{className:"bg-white/5 rounded-lg p-3",children:n.jsx("pre",{className:"text-xs text-white/70 overflow-x-auto",children:typeof e.data=="object"?JSON.stringify(e.data,null,2):e.data})})]})]})},`${e.name}-${t}`))}),n.jsxs("div",{className:"bg-white/10 backdrop-blur-md rounded-2xl shadow-2xl border border-white/20 p-6",children:[n.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:U}),n.jsx("div",{className:"text-white/80 text-sm space-y-2",children:v.map((e,t)=>n.jsxs("p",{children:["â€¢ ",n.jsx("strong",{children:e.title}),": ",e.description]},`${e.title}-${t}`))})]})]})};export{Z as default};
